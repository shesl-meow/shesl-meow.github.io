<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>:moyai:Elf文件分析指北 - shesl's blog</title><meta name=Description content="佘崧林同学的碎碎念博客"><meta property="og:title" content=":moyai:Elf文件分析指北">
<meta property="og:description" content="参考： https://linux-audit.com/elf-binaries-on-linux-understanding-and-analysis/ https://linux-audit.com/elf-binaries-on-linux-understanding-and-analysis/ https://lief.quarkslab.com/doc/stable/tutorials/05_elf_infect_plt_got.html http://blog.k3170makan.com/2018/10/introduction-to-elf-format-part-v.html http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html https://stackoverflow.com/questions/34966097/what-functions-does-gcc-add-to-the-linux-elf 文件格式 ELF is the abbreviation for Executable and Linkable Format and defines the structure for binaries, libraries, and core files. The formal specification allows the operating system to interpreter its underlying machine instructions correctly. ELF files are typically the output of a compiler or linker and are a binary format. With the right tools, such file can be"><meta property="og:type" content="article"><meta property="og:url" content="http://shesl-meow.github.io/posts/elf%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E6%8C%87%E5%8C%97/"><meta property="og:image" content="http://shesl-meow.github.io/avatar.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-29T22:27:32+08:00"><meta property="article:modified_time" content="2019-08-29T22:27:32+08:00"><meta property="og:site_name" content="shesl's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://shesl-meow.github.io/avatar.png"><meta name=twitter:title content=":moyai:Elf文件分析指北"><meta name=twitter:description content="参考： https://linux-audit.com/elf-binaries-on-linux-understanding-and-analysis/ https://linux-audit.com/elf-binaries-on-linux-understanding-and-analysis/ https://lief.quarkslab.com/doc/stable/tutorials/05_elf_infect_plt_got.html http://blog.k3170makan.com/2018/10/introduction-to-elf-format-part-v.html http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html https://stackoverflow.com/questions/34966097/what-functions-does-gcc-add-to-the-linux-elf 文件格式 ELF is the abbreviation for Executable and Linkable Format and defines the structure for binaries, libraries, and core files. The formal specification allows the operating system to interpreter its underlying machine instructions correctly. ELF files are typically the output of a compiler or linker and are a binary format. With the right tools, such file can be"><meta name=application-name content="shesl's blog"><meta name=apple-mobile-web-app-title content="shesl's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://shesl-meow.github.io/posts/elf%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E6%8C%87%E5%8C%97/><link rel=prev href=http://shesl-meow.github.io/posts/%E5%A0%86%E5%8C%BA%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/><link rel=next href=http://shesl-meow.github.io/posts/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%8A%80%E6%9C%AF/><link rel=stylesheet href=/css/style.min.f9dcece0006720752966c5ab2d548675424bb8b985943a9e2d120f7b736cf8eb.css integrity="sha256-+dzs4ABnIHUpZsWrLVSGdUJLuLmFlDqeLRIPe3Ns+Os="><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":":moyai:Elf文件分析指北","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/shesl-meow.github.io\/posts\/elf%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E6%8C%87%E5%8C%97\/"},"genre":"posts","keywords":"Linux, 服务端, 信息安全, C\u002b\u002b","wordcount":4010,"url":"http:\/\/shesl-meow.github.io\/posts\/elf%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E6%8C%87%E5%8C%97\/","datePublished":"2019-08-29T22:27:32+08:00","dateModified":"2019-08-29T22:27:32+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"佘崧林"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><script src=https://unpkg.com/vue@2></script><div class=header-wrapper><div class=header-title><a href=/ title="shesl's blog">shesl-meow</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>博客
</a><a class=menu-item href=/tags/>标签
</a><a class=menu-item href=/categories/>分类
</a><a class=menu-item href=/note/>笔记</a><div class=dropdown><a class="menu-item menu-more dropbtn" title href=javascript:void(0);>游戏</a><div class="menu-more-content dropdown-content"><a href=/games/2048/ title><i class='fa-solid fa-puzzle-piece'></i> 2048 </a><a href=/games/schulte/ title><i class='fa-solid fa-chess-board'></i> Schulte</a></div></div><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="shesl's blog">shesl-meow</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/>博客
</a><a class=menu-item href=/tags/>标签
</a><a class=menu-item href=/categories/>分类
</a><a class=menu-item href=/note/>笔记</a><div class=dropdown><a class="menu-item menu-more dropbtn" title href=javascript:void(0);>游戏</a><div class="menu-more-content dropdown-content"><a href=/games/2048/ title><i class='fa-solid fa-puzzle-piece'></i> 2048 </a><a href=/games/schulte/ title><i class='fa-solid fa-chess-board'></i> Schulte</a></div></div><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">🗿Elf文件分析指北</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://shesl-meow.github.io title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>佘崧林</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2019-08-29>2019-08-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 4010 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 9 分钟&nbsp;<span id=/posts/elf%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E6%8C%87%E5%8C%97/ class=leancloud_visitors data-flag-title=:moyai:Elf文件分析指北>
<i class="far fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#文件格式>文件格式</a></li><li><a href=#elf-header>ELF Header</a><ul><li><a href=#magic>Magic</a></li><li><a href=#class>Class</a></li><li><a href=#data>Data</a></li><li><a href=#version>Version</a></li><li><a href=#osabi>OS/ABI</a></li><li><a href=#abi-version>ABI version</a></li><li><a href=#machine>Machine</a></li><li><a href=#type>Type</a></li></ul></li><li><a href=#file-data>File Data</a><ul><li><a href=#segments-program-headers>Segments (Program Headers)</a></li><li><a href=#sections-sections-headers>Sections (Sections Headers)</a></li></ul></li><li><a href=#elf如何加载文件外的系统链接库>Elf如何加载文件外的系统链接库</a><ul><li><a href=#动态链接过程>动态链接过程</a></li><li><a href=#动态链接节>动态链接节</a></li></ul></li><li><a href=#main-函数是如何执行的><code>main</code> 函数是如何执行的</a><ul><li><a href=#__libc_start_main-函数流程><code>__libc_start_main</code> 函数流程</a></li><li><a href=#__libc_start_main-节作用><code>__libc_start_main</code> 节作用</a></li></ul></li><li><a href=#postscript-分析工具>PostScript: 分析工具</a><ul><li><a href=#elfutils><code>elfutils</code></a></li><li><a href=#elfkickers><code>elfkickers</code></a></li><li><a href=#pax-utils><code>pax-utils</code></a></li><li><a href=#我习惯用的>我习惯用的</a></li></ul></li></ul></nav></div></div><div class=content id=content><blockquote><p>参考：</p><ul><li><a href=https://linux-audit.com/elf-binaries-on-linux-understanding-and-analysis/ target=_blank rel="noopener noreffer">https://linux-audit.com/elf-binaries-on-linux-understanding-and-analysis/</a></li><li><a href=https://linux-audit.com/elf-binaries-on-linux-understanding-and-analysis/ target=_blank rel="noopener noreffer">https://linux-audit.com/elf-binaries-on-linux-understanding-and-analysis/</a></li><li><a href=https://lief.quarkslab.com/doc/stable/tutorials/05_elf_infect_plt_got.html target=_blank rel="noopener noreffer">https://lief.quarkslab.com/doc/stable/tutorials/05_elf_infect_plt_got.html</a></li><li><a href=http://blog.k3170makan.com/2018/10/introduction-to-elf-format-part-v.html target=_blank rel="noopener noreffer">http://blog.k3170makan.com/2018/10/introduction-to-elf-format-part-v.html</a></li><li><a href=http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html target=_blank rel="noopener noreffer">http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html</a></li><li><a href=https://stackoverflow.com/questions/34966097/what-functions-does-gcc-add-to-the-linux-elf target=_blank rel="noopener noreffer">https://stackoverflow.com/questions/34966097/what-functions-does-gcc-add-to-the-linux-elf</a></li></ul></blockquote><h2 id=文件格式>文件格式</h2><p>ELF is the abbreviation for <strong>Executable and Linkable Format</strong> and defines the structure for binaries, libraries, and core files.</p><p>The formal specification allows the operating system to interpreter its underlying machine instructions correctly. ELF files are typically the output of a compiler or linker and are a binary format. With the right tools, such file can be analyzed and better understood.</p><p>Due to the extensible design of ELF files, the structure differs per file. An ELF file consists of:</p><ol><li><p>ELF header</p></li><li><p>File data which consist of three parts:</p><ol><li><p>Program Headers or <code>Segments (9)</code></p></li><li><p>Section Headers or <code>Sections (28)</code></p></li><li><p>Data</p></li></ol></li></ol><h2 id=elf-header>ELF Header</h2><p>With the <code>readelf</code> command, we can look at the structure of a file and it will look something like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ readelf -h ret2dlresolve
</span></span><span class=line><span class=cl>ELF Header:
</span></span><span class=line><span class=cl>  Magic:   7f <span class=m>45</span> 4c <span class=m>46</span> <span class=m>01</span> <span class=m>01</span> <span class=m>01</span> <span class=m>00</span> <span class=m>00</span> <span class=m>00</span> <span class=m>00</span> <span class=m>00</span> <span class=m>00</span> <span class=m>00</span> <span class=m>00</span> <span class=m>00</span>
</span></span><span class=line><span class=cl>  Class:                             ELF32
</span></span><span class=line><span class=cl>  Data:                              2<span class=err>&#39;</span>s complement, little endian
</span></span><span class=line><span class=cl>  Version:                           <span class=m>1</span> <span class=o>(</span>current<span class=o>)</span>
</span></span><span class=line><span class=cl>  OS/ABI:                            UNIX - System V
</span></span><span class=line><span class=cl>  ABI Version:                       <span class=m>0</span>
</span></span><span class=line><span class=cl>  Type:                              DYN <span class=o>(</span>Shared object file<span class=o>)</span>
</span></span><span class=line><span class=cl>  Machine:                           Intel <span class=m>80386</span>
</span></span><span class=line><span class=cl>  Version:                           0x1
</span></span><span class=line><span class=cl>  Entry point address:               0x4b0
</span></span><span class=line><span class=cl>  Start of program headers:          <span class=m>52</span> <span class=o>(</span>bytes into file<span class=o>)</span>
</span></span><span class=line><span class=cl>  Start of section headers:          <span class=m>6216</span> <span class=o>(</span>bytes into file<span class=o>)</span>
</span></span><span class=line><span class=cl>  Flags:                             0x0
</span></span><span class=line><span class=cl>  Size of this header:               <span class=m>52</span> <span class=o>(</span>bytes<span class=o>)</span>
</span></span><span class=line><span class=cl>  Size of program headers:           <span class=m>32</span> <span class=o>(</span>bytes<span class=o>)</span>
</span></span><span class=line><span class=cl>  Number of program headers:         <span class=m>9</span>
</span></span><span class=line><span class=cl>  Size of section headers:           <span class=m>40</span> <span class=o>(</span>bytes<span class=o>)</span>
</span></span><span class=line><span class=cl>  Number of section headers:         <span class=m>29</span>
</span></span><span class=line><span class=cl>  Section header string table index: <span class=m>28</span>
</span></span></code></pre></td></tr></table></div></div><p>下面依次解释上面从 <code>readelf</code> 中读取出来的信息：</p><h3 id=magic>Magic</h3><p>As can be seen in this screenshot, the ELF header starts with some magic.</p><p>This ELF header magic provides information about the file. The first 4 hexadecimal parts define that this is an ELF file (45=<code>E</code>, 4c=<code>L</code>, 46=<code>F</code>), prefixed with the <strong>7f</strong> value.</p><p>This ELF header is mandatory. It ensures that data is correctly interpreted during linking or execution. To better understand the inner working of an ELF file, it is useful to know this header information is used.</p><h3 id=class>Class</h3><p>After the ELF type declaration, there is a Class field defined. This value determines the architecture for the file. It can a <strong>32-bit</strong> (=01) or <strong>64-bit</strong> (=02) architecture.</p><p>The magic shows a 01, which is translated by the <code>readelf</code> command as an <code>ELF32</code> file. In other words, an ELF file using the 32-bit architecture. Not surprising, as this particular machine contains a modern CPU.</p><h3 id=data>Data</h3><p>Next part is the data field. It knows two options: 01 for <strong>LSB</strong> (<a href=https://en.wikipedia.org/wiki/Least_significant_bit target=_blank rel="noopener noreffer">Least Significant Bit</a>), also known as little-endian. Then there is the value 02, for <strong>MSB</strong> (Most Significant Bit, big-endian).</p><p>This particular value helps to interpret the remaining objects correctly within the file. This is important, as different types of processors deal differently with the incoming instructions and data structures. In this case, LSB is used, which is common for AMD64 type processors.</p><h3 id=version>Version</h3><p>Currently, there is only 1 version type: currently, which is the value “01”. So nothing interesting to remember.</p><h3 id=osabi>OS/ABI</h3><p>Each operating system has a big overlap in common functions. In addition, each of them has specific ones, or at least minor differences between them. The definition of the right set is done with an <strong>Application Binary Interface</strong> (<a href=https://en.wikipedia.org/wiki/Application_binary_interface target=_blank rel="noopener noreffer">ABI</a>). This way the operating system and applications both know what to expect and functions are correctly forwarded. These two fields describe what ABI is used and the related version.</p><p>In this case, the value is 00, which means no specific extension is used.</p><h3 id=abi-version>ABI version</h3><p>When needed, a version for the ABI can be specified.</p><h3 id=machine>Machine</h3><p>We can also find the expected machine type (AMD64) in the header.</p><h3 id=type>Type</h3><p>The <strong>type</strong> field tells us what the purpose of the file is. There are a few common file types.</p><ul><li>CORE (value 4)</li><li>DYN (Shared object file), for libraries (value 3)</li><li>EXEC (Executable file), for binaries (value 2)</li><li>REL (Relocatable file), before linked into an executable file (value 1)</li></ul><h2 id=file-data>File Data</h2><p>Before we dive into these headers, it is good to know that ELF has two complementary “views”:</p><ol><li><p>One is to be used for the linker to allow execution (segments).</p></li><li><p>The other one for categorizing instructions and data (sections).</p></li></ol><p>So depending on the goal, the related header types are used. Let’s start with program headers, which we find on ELF binaries.</p><h3 id=segments-program-headers>Segments (Program Headers)</h3><p>An ELF file consists of zero or more segments, and describe how to create a process/memory image for runtime execution.</p><p>When the kernel sees these segments, it uses them to map them into virtual address space, using the <code>mmap(2)</code> system call. In other words, it converts predefined instructions into a memory image. If your ELF file is a normal binary, it requires these program headers. Otherwise, it simply won’t run. It uses these headers, with the underlying data structure, to form a process. This process is similar for shared libraries.</p><p>可以用 <code>readelf</code> 命令 <code>--segments</code> 参数或者 <code>--program-headers</code> 参数查看程序头信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ readelf --segments ./ret2dlresolve
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Elf file <span class=nb>type</span> is DYN <span class=o>(</span>Shared object file<span class=o>)</span>
</span></span><span class=line><span class=cl>Entry point 0x4b0
</span></span><span class=line><span class=cl>There are <span class=m>9</span> program headers, starting at offset <span class=m>52</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Program Headers:
</span></span><span class=line><span class=cl>  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
</span></span><span class=line><span class=cl>  PHDR           0x000034 0x00000034 0x00000034 0x00120 0x00120 R   0x4
</span></span><span class=line><span class=cl>  INTERP         0x000154 0x00000154 0x00000154 0x00013 0x00013 R   0x1
</span></span><span class=line><span class=cl>      <span class=o>[</span>Requesting program interpreter: /lib/ld-linux.so.2<span class=o>]</span>
</span></span><span class=line><span class=cl>  LOAD           0x000000 0x00000000 0x00000000 0x008b0 0x008b0 R E 0x1000
</span></span><span class=line><span class=cl>  LOAD           0x000ec4 0x00001ec4 0x00001ec4 0x00144 0x00148 RW  0x1000
</span></span><span class=line><span class=cl>  DYNAMIC        0x000ecc 0x00001ecc 0x00001ecc 0x000f8 0x000f8 RW  0x4
</span></span><span class=line><span class=cl>  NOTE           0x000168 0x00000168 0x00000168 0x00044 0x00044 R   0x4
</span></span><span class=line><span class=cl>  GNU_EH_FRAME   0x000760 0x00000760 0x00000760 0x0003c 0x0003c R   0x4
</span></span><span class=line><span class=cl>  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x10
</span></span><span class=line><span class=cl>  GNU_RELRO      0x000ec4 0x00001ec4 0x00001ec4 0x0013c 0x0013c R   0x1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Section to Segment mapping:
</span></span><span class=line><span class=cl>  Segment Sections...
</span></span><span class=line><span class=cl>   <span class=m>00</span>
</span></span><span class=line><span class=cl>   <span class=m>01</span>     .interp
</span></span><span class=line><span class=cl>   <span class=m>02</span>     .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .plt.got .text .fini .rodata .eh_frame_hdr .eh_frame
</span></span><span class=line><span class=cl>   <span class=m>03</span>     .init_array .fini_array .dynamic .got .data .bss
</span></span><span class=line><span class=cl>   <span class=m>04</span>     .dynamic
</span></span><span class=line><span class=cl>   <span class=m>05</span>     .note.ABI-tag .note.gnu.build-id
</span></span><span class=line><span class=cl>   <span class=m>06</span>     .eh_frame_hdr
</span></span><span class=line><span class=cl>   <span class=m>07</span>
</span></span><span class=line><span class=cl>   <span class=m>08</span>     .init_array .fini_array .dynamic .got
</span></span></code></pre></td></tr></table></div></div><p>我们看到上面一共有九个程序头，我们只看其中的两个比较重要的信息：</p><ol><li><code>GNU_EH_FRAME</code>：这里存储着 <code>gcc</code> 的一个队列，它里面存储的是处理程序异常的句柄。程序异常时，这个区域会正确处理这些异常；</li><li><code>GNU_STACK</code>：这里时程序的栈区信息。可以看到栈区时只是可读可写的。</li></ol><h3 id=sections-sections-headers>Sections (Sections Headers)</h3><p>Sections can be found in an ELF binary after the GNU C compiler transformed C code into assembly, followed by the GNU assembler, which creates objects of it.</p><p>同样的我们也可以用 <code>readelf</code> 命令的 <code>--sections</code> 参数或 <code>--sections-headers</code> 参数查看程序的节头信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ readelf --sections ./ret2dlresolve
</span></span><span class=line><span class=cl>There are <span class=m>29</span> section headers, starting at offset 0x1848:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Section Headers:
</span></span><span class=line><span class=cl>  <span class=o>[</span>Nr<span class=o>]</span> Name              Type            Addr     Off    Size   ES Flg Lk Inf Al
</span></span><span class=line><span class=cl>  <span class=o>[</span> 0<span class=o>]</span>                   NULL            <span class=m>00000000</span> <span class=m>000000</span> <span class=m>000000</span> <span class=m>00</span>      <span class=m>0</span>   <span class=m>0</span>  <span class=m>0</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> 1<span class=o>]</span> .interp           PROGBITS        <span class=m>00000154</span> <span class=m>000154</span> <span class=m>000013</span> <span class=m>00</span>   A  <span class=m>0</span>   <span class=m>0</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> 2<span class=o>]</span> .note.ABI-tag     NOTE            <span class=m>00000168</span> <span class=m>000168</span> <span class=m>000020</span> <span class=m>00</span>   A  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> 3<span class=o>]</span> .note.gnu.build-i NOTE            <span class=m>00000188</span> <span class=m>000188</span> <span class=m>000024</span> <span class=m>00</span>   A  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> 4<span class=o>]</span> .gnu.hash         GNU_HASH        000001ac 0001ac <span class=m>000020</span> <span class=m>04</span>   A  <span class=m>5</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> 5<span class=o>]</span> .dynsym           DYNSYM          000001cc 0001cc 0000d0 <span class=m>10</span>   A  <span class=m>6</span>   <span class=m>1</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> 6<span class=o>]</span> .dynstr           STRTAB          0000029c 00029c 0000bc <span class=m>00</span>   A  <span class=m>0</span>   <span class=m>0</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> 7<span class=o>]</span> .gnu.version      VERSYM          <span class=m>00000358</span> <span class=m>000358</span> 00001a <span class=m>02</span>   A  <span class=m>5</span>   <span class=m>0</span>  <span class=m>2</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> 8<span class=o>]</span> .gnu.version_r    VERNEED         <span class=m>00000374</span> <span class=m>000374</span> <span class=m>000030</span> <span class=m>00</span>   A  <span class=m>6</span>   <span class=m>1</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> 9<span class=o>]</span> .rel.dyn          REL             000003a4 0003a4 <span class=m>000050</span> <span class=m>08</span>   A  <span class=m>5</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>10<span class=o>]</span> .rel.plt          REL             000003f4 0003f4 <span class=m>000028</span> <span class=m>08</span>  AI  <span class=m>5</span>  <span class=m>22</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>11<span class=o>]</span> .init             PROGBITS        0000041c 00041c <span class=m>000023</span> <span class=m>00</span>  AX  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>12<span class=o>]</span> .plt              PROGBITS        <span class=m>00000440</span> <span class=m>000440</span> <span class=m>000060</span> <span class=m>04</span>  AX  <span class=m>0</span>   <span class=m>0</span> <span class=m>16</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>13<span class=o>]</span> .plt.got          PROGBITS        000004a0 0004a0 <span class=m>000010</span> <span class=m>08</span>  AX  <span class=m>0</span>   <span class=m>0</span>  <span class=m>8</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>14<span class=o>]</span> .text             PROGBITS        000004b0 0004b0 <span class=m>000292</span> <span class=m>00</span>  AX  <span class=m>0</span>   <span class=m>0</span> <span class=m>16</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>15<span class=o>]</span> .fini             PROGBITS        <span class=m>00000744</span> <span class=m>000744</span> <span class=m>000014</span> <span class=m>00</span>  AX  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>16<span class=o>]</span> .rodata           PROGBITS        <span class=m>00000758</span> <span class=m>000758</span> <span class=m>000008</span> <span class=m>00</span>   A  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>17<span class=o>]</span> .eh_frame_hdr     PROGBITS        <span class=m>00000760</span> <span class=m>000760</span> 00003c <span class=m>00</span>   A  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>18<span class=o>]</span> .eh_frame         PROGBITS        0000079c 00079c <span class=m>000114</span> <span class=m>00</span>   A  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>19<span class=o>]</span> .init_array       INIT_ARRAY      00001ec4 000ec4 <span class=m>000004</span> <span class=m>04</span>  WA  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>20<span class=o>]</span> .fini_array       FINI_ARRAY      00001ec8 000ec8 <span class=m>000004</span> <span class=m>04</span>  WA  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>21<span class=o>]</span> .dynamic          DYNAMIC         00001ecc 000ecc 0000f8 <span class=m>08</span>  WA  <span class=m>6</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>22<span class=o>]</span> .got              PROGBITS        00001fc4 000fc4 00003c <span class=m>04</span>  WA  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>23<span class=o>]</span> .data             PROGBITS        <span class=m>00002000</span> <span class=m>001000</span> <span class=m>000008</span> <span class=m>00</span>  WA  <span class=m>0</span>   <span class=m>0</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>24<span class=o>]</span> .bss              NOBITS          <span class=m>00002008</span> <span class=m>001008</span> <span class=m>000004</span> <span class=m>00</span>  WA  <span class=m>0</span>   <span class=m>0</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>25<span class=o>]</span> .comment          PROGBITS        <span class=m>00000000</span> <span class=m>001008</span> 00002b <span class=m>01</span>  MS  <span class=m>0</span>   <span class=m>0</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>26<span class=o>]</span> .symtab           SYMTAB          <span class=m>00000000</span> <span class=m>001034</span> <span class=m>000480</span> <span class=m>10</span>     <span class=m>27</span>  <span class=m>43</span>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>27<span class=o>]</span> .strtab           STRTAB          <span class=m>00000000</span> 0014b4 <span class=m>000297</span> <span class=m>00</span>      <span class=m>0</span>   <span class=m>0</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span>28<span class=o>]</span> .shstrtab         STRTAB          <span class=m>00000000</span> 00174b 0000fc <span class=m>00</span>      <span class=m>0</span>   <span class=m>0</span>  <span class=m>1</span>
</span></span><span class=line><span class=cl>Key to Flags:
</span></span><span class=line><span class=cl>  W <span class=o>(</span>write<span class=o>)</span>, A <span class=o>(</span>alloc<span class=o>)</span>, X <span class=o>(</span>execute<span class=o>)</span>, M <span class=o>(</span>merge<span class=o>)</span>, S <span class=o>(</span>strings<span class=o>)</span>, I <span class=o>(</span>info<span class=o>)</span>,
</span></span><span class=line><span class=cl>  L <span class=o>(</span>link order<span class=o>)</span>, O <span class=o>(</span>extra OS processing required<span class=o>)</span>, G <span class=o>(</span>group<span class=o>)</span>, T <span class=o>(</span>TLS<span class=o>)</span>,
</span></span><span class=line><span class=cl>  C <span class=o>(</span>compressed<span class=o>)</span>, x <span class=o>(</span>unknown<span class=o>)</span>, o <span class=o>(</span>OS specific<span class=o>)</span>, E <span class=o>(</span>exclude<span class=o>)</span>,
</span></span><span class=line><span class=cl>  p <span class=o>(</span>processor specific<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>我们分析时可能关心以下几个比较重要的节头：</p><ol><li><code>.text</code>：该段包含的是可执行代码，该段中的数据只可读不可写，该段中的数据只加载一次。</li><li><code>.data</code>：已被初始化的数据，可读可写。</li><li><code>.rodata</code>：已被初始化的数据，只可读不可写。</li><li><code>.bss</code>：未初始化数据，可读可写。</li></ol><h2 id=elf如何加载文件外的系统链接库>Elf如何加载文件外的系统链接库</h2><h3 id=动态链接过程>动态链接过程</h3><p>此处详解以下动态链接过程中最重要的部分，<code>libc</code> 函数的链接过程。<code>libc</code> 中的函数，若使用动态链接，则关键的两个表项时 <code>.got</code> 表与 <code>.plt</code> 表，这种绑定方式又称为延迟绑定。</p><p>比如我们在某一个函数中进行了 <code>puts</code> 系统调用，在调用之前表结构大致如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>                                                         
</span></span><span class=line><span class=cl>  .text sections       .plt table         .got table      
</span></span><span class=line><span class=cl>                                                          
</span></span><span class=line><span class=cl> +--------------+    +---------------+   +------------------+   
</span></span><span class=line><span class=cl> | [my_func]    |    | [puts@plt]    |   | [puts@got]       |   
</span></span><span class=line><span class=cl> |              |    |               |   |                  |   
</span></span><span class=line><span class=cl> | jmp 0x400480 ----&gt;| jmp 0x601028  ---&gt;| 0x601028:0x400486--+  
</span></span><span class=line><span class=cl> |              |    |               |   |                  | |  
</span></span><span class=line><span class=cl> | ...          | +-&gt;| push 0x2      |   | ...              | |  
</span></span><span class=line><span class=cl> +--------------+ |  |               |   +------------------+ |  
</span></span><span class=line><span class=cl>                  |  | jmp 0x400450  --+                      |  
</span></span><span class=line><span class=cl>                  |  |               | |                      |  
</span></span><span class=line><span class=cl>                  |  | ...           | |                      |  
</span></span><span class=line><span class=cl>                  |  +---------------+ |                      |  
</span></span><span class=line><span class=cl>                  +--------------------|----------------------+  
</span></span><span class=line><span class=cl>                +----------------------+                   
</span></span><span class=line><span class=cl>                |   +------------------+                  
</span></span><span class=line><span class=cl>                +--&gt;|[_dl_resolve@plt] |                  
</span></span><span class=line><span class=cl>                    +------------------+                       
</span></span></code></pre></td></tr></table></div></div><p>可见：</p><ol><li><code>.text</code> 段中任何对 <code>libc</code> 函数得调用，编译是只会将程序执行权交给 <code>.plt</code> 表；</li><li><code>.plt</code> 表实际上是一段代码，<code>.got</code> 表实际上只是地址到地址的映射；</li><li>一个函数对应的 <code>.plt</code> 表代码由三行组成：<ol><li><code>.plt</code> 表的第一行指向 <code>.got</code> 表对应的位置；</li><li>如果函数第一次调用，<code>.got</code> 默认会指向 <code>.plt</code> 表的第二行；</li><li><code>.plt</code> 表的第二三行调用 <code>_dl_runtime_resolve</code> 函数，将实际的地址导入 <code>.got</code> 表中</li></ol></li></ol><p>也就是说，调用了之后，这三段结构会变成下面的结构：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>                                                         
</span></span><span class=line><span class=cl>  .text sections      .plt table         .got table      
</span></span><span class=line><span class=cl>                                                         
</span></span><span class=line><span class=cl> +--------------+   +---------------+   +--------------+ 
</span></span><span class=line><span class=cl> | [my_func]    |   | [puts@plt]    |   | [puts@got]   | 
</span></span><span class=line><span class=cl> |              |   |               |   |              | 
</span></span><span class=line><span class=cl> | jmp 0x400480 ---&gt;| jmp 0x601028  ---&gt;| 0x601028:puts-----&gt;puts 
</span></span><span class=line><span class=cl> |              |   |               |   |              | 
</span></span><span class=line><span class=cl> | ...          |   | push 0x2      |   | ...          | 
</span></span><span class=line><span class=cl> +--------------+   |               |   +--------------+ 
</span></span><span class=line><span class=cl>                    | jmp 0x400450  --+                  
</span></span><span class=line><span class=cl>                    |               | |                  
</span></span><span class=line><span class=cl>                    | ...           | |                  
</span></span><span class=line><span class=cl>                    +---------------+ |                  
</span></span><span class=line><span class=cl>                                      |                  
</span></span><span class=line><span class=cl>               +----------------------v                  
</span></span><span class=line><span class=cl>               |   +------------------+                  
</span></span><span class=line><span class=cl>               ---&gt;|[_dl_resolve@plt] |                  
</span></span><span class=line><span class=cl>                   +------------------+                  
</span></span></code></pre></td></tr></table></div></div><h3 id=动态链接节>动态链接节</h3><p>在使用 <code>readelf</code> 命令查看一个程序的节列表时，类型为 <code>REL</code> 的节区包含重定位表项：</p><ol><li><p><code>.got</code> 节保存全局变量偏移表，<code>.got.plt</code> 节保存全局函数偏移表；<code>.plt</code> 节是过程链接表。过程链接表把位置独立的函数调用重定向到绝对位置。</p></li><li><p><code>.rel.dyn</code> 节是用于变量重定位，<code>.rel.plt</code> 节是用于函数重定位。</p><p>可以使用 <code>readelf</code> 命令的 <code>--relocs</code> 参数查看这两个节区的内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ readelf -r ./ret2dlresolve
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>重定位节 <span class=s1>&#39;.rel.dyn&#39;</span> at offset 0x3a4 contains <span class=m>10</span> entries:
</span></span><span class=line><span class=cl> 偏移量     信息    类型              符号值      符号名称
</span></span><span class=line><span class=cl>00001ec4  <span class=m>00000008</span> R_386_RELATIVE   
</span></span><span class=line><span class=cl>00001ec8  <span class=m>00000008</span> R_386_RELATIVE   
</span></span><span class=line><span class=cl>00001ff8  <span class=m>00000008</span> R_386_RELATIVE   
</span></span><span class=line><span class=cl><span class=m>00002004</span>  <span class=m>00000008</span> R_386_RELATIVE   
</span></span><span class=line><span class=cl>00001fe4  <span class=m>00000306</span> R_386_GLOB_DAT    <span class=m>00000000</span>   _ITM_deregisterTMClone
</span></span><span class=line><span class=cl>00001fe8  <span class=m>00000406</span> R_386_GLOB_DAT    <span class=m>00000000</span>   __cxa_finalize@GLIBC_2.1.3
</span></span><span class=line><span class=cl>00001fec  <span class=m>00000506</span> R_386_GLOB_DAT    <span class=m>00000000</span>   __gmon_start__
</span></span><span class=line><span class=cl>00001ff0  <span class=m>00000906</span> R_386_GLOB_DAT    <span class=m>00000000</span>   stdin@GLIBC_2.0
</span></span><span class=line><span class=cl>00001ff4  00000a06 R_386_GLOB_DAT    <span class=m>00000000</span>   stdout@GLIBC_2.0
</span></span><span class=line><span class=cl>00001ffc  00000b06 R_386_GLOB_DAT    <span class=m>00000000</span>   _ITM_registerTMCloneTa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>重定位节 <span class=s1>&#39;.rel.plt&#39;</span> at offset 0x3f4 contains <span class=m>5</span> entries:
</span></span><span class=line><span class=cl> 偏移量     信息    类型              符号值      符号名称
</span></span><span class=line><span class=cl>00001fd0  <span class=m>00000107</span> R_386_JUMP_SLOT   <span class=m>00000000</span>   setbuf@GLIBC_2.0
</span></span><span class=line><span class=cl>00001fd4  <span class=m>00000207</span> R_386_JUMP_SLOT   <span class=m>00000000</span>   read@GLIBC_2.0
</span></span><span class=line><span class=cl>00001fd8  <span class=m>00000607</span> R_386_JUMP_SLOT   <span class=m>00000000</span>   strlen@GLIBC_2.0
</span></span><span class=line><span class=cl>00001fdc  <span class=m>00000707</span> R_386_JUMP_SLOT   <span class=m>00000000</span>   __libc_start_main@GLIBC_2.0
</span></span><span class=line><span class=cl>00001fe0  <span class=m>00000807</span> R_386_JUMP_SLOT   <span class=m>00000000</span>   write@GLIBC_2.0
</span></span></code></pre></td></tr></table></div></div></li><li><p><code>.dynsym</code> 节包含了动态链接符号表。可以用 <code>readelf</code> 命令的 <code>--symbols</code> 参数查看：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ readelf --symbols ./ret2dlresolve
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Symbol table <span class=s1>&#39;.dynsym&#39;</span> contains <span class=m>13</span> entries:
</span></span><span class=line><span class=cl>   Num:    Value  Size Type    Bind   Vis      Ndx Name
</span></span><span class=line><span class=cl>     0: <span class=m>00000000</span>     <span class=m>0</span> NOTYPE  LOCAL  DEFAULT  UND 
</span></span><span class=line><span class=cl>     1: <span class=m>00000000</span>     <span class=m>0</span> FUNC    GLOBAL DEFAULT  UND setbuf@GLIBC_2.0 <span class=o>(</span>2<span class=o>)</span>
</span></span><span class=line><span class=cl>     2: <span class=m>00000000</span>     <span class=m>0</span> FUNC    GLOBAL DEFAULT  UND read@GLIBC_2.0 <span class=o>(</span>2<span class=o>)</span>
</span></span><span class=line><span class=cl>     3: <span class=m>00000000</span>     <span class=m>0</span> NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTab
</span></span><span class=line><span class=cl>     4: <span class=m>00000000</span>     <span class=m>0</span> FUNC    WEAK   DEFAULT  UND __cxa_finalize@GLIBC_2.1.3 <span class=o>(</span>3<span class=o>)</span>
</span></span><span class=line><span class=cl>     5: <span class=m>00000000</span>     <span class=m>0</span> NOTYPE  WEAK   DEFAULT  UND __gmon_start__
</span></span><span class=line><span class=cl>     6: <span class=m>00000000</span>     <span class=m>0</span> FUNC    GLOBAL DEFAULT  UND strlen@GLIBC_2.0 <span class=o>(</span>2<span class=o>)</span>
</span></span><span class=line><span class=cl>     7: <span class=m>00000000</span>     <span class=m>0</span> FUNC    GLOBAL DEFAULT  UND __libc_start_main@GLIBC_2.0 <span class=o>(</span>2<span class=o>)</span>
</span></span><span class=line><span class=cl>     8: <span class=m>00000000</span>     <span class=m>0</span> FUNC    GLOBAL DEFAULT  UND write@GLIBC_2.0 <span class=o>(</span>2<span class=o>)</span>
</span></span><span class=line><span class=cl>     9: <span class=m>00000000</span>     <span class=m>0</span> OBJECT  GLOBAL DEFAULT  UND stdin@GLIBC_2.0 <span class=o>(</span>2<span class=o>)</span>
</span></span><span class=line><span class=cl>    10: <span class=m>00000000</span>     <span class=m>0</span> OBJECT  GLOBAL DEFAULT  UND stdout@GLIBC_2.0 <span class=o>(</span>2<span class=o>)</span>
</span></span><span class=line><span class=cl>    11: <span class=m>00000000</span>     <span class=m>0</span> NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable
</span></span><span class=line><span class=cl>    12: 0000075c     <span class=m>4</span> OBJECT  GLOBAL DEFAULT   <span class=m>16</span> _IO_stdin_used
</span></span><span class=line><span class=cl>....
</span></span></code></pre></td></tr></table></div></div></li><li><p><code>.dynstr</code> 节包含了动态链接的字符串。这个节以 <code>\x00</code> 作为开始和结尾，中间每个字符串也以 <code>\x00</code> 间隔。</p></li></ol><h2 id=main-函数是如何执行的><code>main</code> 函数是如何执行的</h2><h3 id=__libc_start_main-函数流程><code>__libc_start_main</code> 函数流程</h3><p>在介绍这一节之前可以需要先了解以下 Linux 程序是如何启动一个程序的。以下是 loader 的调用图：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./start_callgraph.png data-srcset="./start_callgraph.png, ./start_callgraph.png 1.5x, ./start_callgraph.png 2x" data-sizes=auto alt=./start_callgraph.png title=start_callgraph></p><p>下面我们依次介绍以下整个程序运行的流程：</p><ol><li><p>在 <code>_start</code> 函数之前，Linux 进行了 <code>execuve()</code> 系统调用，在栈上布置好了 <code>argc</code>、<code>argv</code> 与 <code>envp</code> 参数，并且设置好了 <code>stdin</code>、<code>stdout</code>、<code>stderr</code>。</p></li><li><p>在 <code>_start</code> 函数中，传入数个参数执行了 <code>__libc_start_main</code>，这个函数的原型如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>__libc_start_main</span><span class=p>(</span>  <span class=kt>int</span> <span class=p>(</span><span class=o>*</span><span class=n>main</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span> <span class=o>*</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span> <span class=o>*</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			    <span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span> <span class=o>*</span> <span class=n>ubp_av</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			    <span class=kt>void</span> <span class=p>(</span><span class=o>*</span><span class=n>init</span><span class=p>)</span> <span class=p>(</span><span class=kt>void</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			    <span class=kt>void</span> <span class=p>(</span><span class=o>*</span><span class=n>fini</span><span class=p>)</span> <span class=p>(</span><span class=kt>void</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			    <span class=kt>void</span> <span class=p>(</span><span class=o>*</span><span class=n>rtld_fini</span><span class=p>)</span> <span class=p>(</span><span class=kt>void</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			    <span class=kt>void</span> <span class=p>(</span><span class=o>*</span> <span class=n>stack_end</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p>这些参数的含义分别是：</p><ol><li><code>main</code>：程序的主进程，它的返回值最终会传递给 <code>exit</code> 函数，之后退出进程；</li><li><code>arcg</code>、<code>ubp_av</code>：<code>main</code> 函数传入的两个参数 <code>argc</code> 与 <code>argv</code>；</li><li><code>init</code>：<code>__libc_csu_init</code> 的地址，在 <code>main</code> 函数之前调用，程序的构造函数；</li><li><code>fini</code>：<code>__libc_csu_fini</code> 的地址，程序的析构函数；通过 <code>__cxat_exit</code> 函数注册；</li><li><code>rtld_fini</code>：动态链接段的析构函数；通过 <code>__cxat_exit</code> 函数注册；</li><li><code>stack_end</code>：栈的尾指针；</li></ol></li><li><p>然后程序在程序中按照上图的次序依次调用各个函数（这里先不细说了，详见 <a href=http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html target=_blank rel="noopener noreffer">LinuxProgramStart</a>）。</p></li></ol><h3 id=__libc_start_main-节作用><code>__libc_start_main</code> 节作用</h3><p>那么这个过程中主要创建了哪些个节呢？</p><ul><li>主要有三个：<code>preinit_array</code>、<code>init_array</code> 与 <code>fini_array</code>。</li><li>这三个节的本质都是一个<strong>函数指针的数组</strong>。它们存储的函数，会在程序运行的特定时刻，被执行。</li></ul><p>下面分别介绍这三个节：</p><ol><li><code>.preinit_array</code>：其中的函数，会在程序的构造函数（一般指 <code>__libc_csu_init</code>）执行之前，被调用；</li><li><code>.init_array</code>：其中的函数，会在程序构造函数执行之后，<code>main</code> 函数执行之前被执行。这个数组有一个默认就存在的函数 <code>frame_dummy</code>，它用于保护栈的运行与安全。</li><li><code>.fini_array</code>：其中的函数，会在 <code>main</code> 函数执行之后被执行。glibc 中定义了一个函数 <code>__do_global_dtors_aux</code> 会在这个节未被定义时被默认执行，详见 <a href=https://stackoverflow.com/questions/34966097/what-functions-does-gcc-add-to-the-linux-elf target=_blank rel="noopener noreffer">Stack Overflow</a>。</li></ol><p>当然，程序员在写 c 程序时可以自己向数组中添加元素：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>init</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>__FUNCTION__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>__attribute__</span><span class=p>((</span><span class=nf>section</span><span class=p>(</span><span class=s>&#34;.init_array&#34;</span><span class=p>)))</span> <span class=nf>typeof</span><span class=p>(</span><span class=n>init</span><span class=p>)</span> <span class=o>*</span><span class=n>__init</span> <span class=o>=</span> <span class=n>init</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=postscript-分析工具>PostScript: 分析工具</h2><h3 id=elfutils><code>elfutils</code></h3><ul><li>/usr/bin/eu-addr2line</li><li>/usr/bin/eu-ar – alternative to ar, to create, manipulate archive files</li><li>/usr/bin/eu-elfcmp</li><li>/usr/bin/eu-elflint – compliance check against gABI and psABI specifications</li><li>/usr/bin/eu-findtextrel – find text relocations</li><li>/usr/bin/eu-ld – combining object and archive files</li><li>/usr/bin/eu-make-debug-archive</li><li>/usr/bin/eu-nm – display symbols from object/executable files</li><li>/usr/bin/eu-objdump – show information of object files</li><li>/usr/bin/eu-ranlib – create index for archives for performance</li><li>/usr/bin/eu-readelf – human-readable display of ELF files</li><li>/usr/bin/eu-size – display size of each section (text, data, bss, etc)</li><li>/usr/bin/eu-stack – show the stack of a running process, or coredump</li><li>/usr/bin/eu-strings – display textual strings (similar to strings utility)</li><li>/usr/bin/eu-strip – strip ELF file from symbol tables</li><li>/usr/bin/eu-unstrip – add symbols and debug information to stripped binary</li></ul><p><em>Notes: the elfutils package is a great start, as it contains most utilities to perform analysis.</em></p><h3 id=elfkickers><code>elfkickers</code></h3><ul><li>/usr/bin/ebfc – compiler for <a href=https://en.wikipedia.org/wiki/Brainfuck target=_blank rel="noopener noreffer">Brainfuck</a> programming language</li><li>/usr/bin/elfls – shows program headers and section headers with flags</li><li>/usr/bin/elftoc – converts a binary into a C program</li><li>/usr/bin/infect – tool to inject a dropper, which creates setuid file in /tmp</li><li>/usr/bin/objres – creates an object from ordinary or binary data</li><li>/usr/bin/rebind – changes bindings/visibility of symbols in ELF file</li><li>/usr/bin/sstrip – strips unneeded components from ELF file</li></ul><p><em>Notes: the author of the ELFKickers package focuses on manipulation of ELF files, which might be great to learn more when you find malformed ELF binaries.</em></p><h3 id=pax-utils><code>pax-utils</code></h3><ul><li>/usr/bin/dumpelf – dump internal ELF structure</li><li>/usr/bin/lddtree – like ldd, with levels to show dependencies</li><li>/usr/bin/pspax – list ELF/PaX information about running processes</li><li>/usr/bin/scanelf – wide range of information, including PaX details</li><li>/usr/bin/scanmacho – shows details for Mach-O binaries (Mac OS X)</li><li>/usr/bin/symtree – displays a leveled output for symbols</li></ul><h3 id=我习惯用的>我习惯用的</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看文件头</span>
</span></span><span class=line><span class=cl>$ readelf --file-header &lt;program&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看程序头</span>
</span></span><span class=line><span class=cl>$ readelf --program-headers &lt;program&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看节头</span>
</span></span><span class=line><span class=cl>$ readelf --section-headers &lt;program&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看动态链接的依赖</span>
</span></span><span class=line><span class=cl>$ lddtree &lt;program&gt;
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2019-08-29</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=http://shesl-meow.github.io/posts/elf%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E6%8C%87%E5%8C%97/ data-title=:moyai:Elf文件分析指北 data-hashtags=Linux,服务端,信息安全,C++><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=http://shesl-meow.github.io/posts/elf%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E6%8C%87%E5%8C%97/ data-hashtag=Linux><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=http://shesl-meow.github.io/posts/elf%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E6%8C%87%E5%8C%97/ data-title=:moyai:Elf文件分析指北 data-ralateuid=3968720593><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/linux/>Linux</a>,&nbsp;<a href=/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF/>服务端</a>,&nbsp;<a href=/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/>信息安全</a>,&nbsp;<a href=/tags/c++/>C++</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/%E5%A0%86%E5%8C%BA%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/ class=prev rel=prev title=:truck:堆区如何进行内存分配><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>🚚堆区如何进行内存分配</a>
<a href=/posts/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%8A%80%E6%9C%AF/ class=next rel=next title=:floppy_disk:客户端本地存储技术>💾客户端本地存储技术<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://shesl-meow.github.io target=_blank>佘崧林</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.8127f0ca4cabc7246f3620f3ef3bf9b1db02805dfe03d6d4c57bc74bc0bf6eea.js integrity="sha256-gSfwykyrxyRvNiDz7zv5sdsCgF3+A9bUxXvHS8C/buo="></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.825fab54c26891370cbd3df4cdff5c9de31af8bb84474e6774573463d8708ae7.js integrity="sha256-gl+rVMJokTcMvT30zf9cneMa+LuER05ndFc0Y9hwiuc="></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{valine:{appId:"zDVJohJIQbD6f3W267xtaYRC-gzGzoHsz",appKey:"ewsfU9ocNOeuvt0MzONe6yKx",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-CN",pageSize:10,placeholder:"你的评论 ...",recordIP:!0,serverURLs:"https://zdvjohji.lc-cn-n1-shared.com",visitor:!0}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30}}</script><script type=text/javascript src=/js/theme.min.d7121d72cd85153ec9d35a888cee3eb28c2700ca763f649a538f6c772d750021.js integrity="sha256-1xIdcs2FFT7J01qIjO4+sownAMp2P2SaU49sdy11ACE="></script></body></html>