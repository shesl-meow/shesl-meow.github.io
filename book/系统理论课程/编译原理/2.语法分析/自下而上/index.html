<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>- shesl's blog</title><meta name=Description content="佘崧林同学的碎碎念博客"><meta property="og:title" content><meta property="og:description" content="自下而上 Bottom-up 从输入串开始，逐步进行归约，直到文法的开始符号。 规约：根据文法的产生式规则，把串中出现的产生式右部替换成左部符号； 从树的叶节点开始"><meta property="og:type" content="article"><meta property="og:url" content="http://shesl-meow.github.io/book/%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E8%AF%BE%E7%A8%8B/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/2.%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90/%E8%87%AA%E4%B8%8B%E8%80%8C%E4%B8%8A/"><meta property="og:image" content="http://shesl-meow.github.io/avatar.png"><meta property="article:section" content="book"><meta property="og:site_name" content="shesl's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://shesl-meow.github.io/avatar.png"><meta name=twitter:title content><meta name=twitter:description content="自下而上 Bottom-up 从输入串开始，逐步进行归约，直到文法的开始符号。 规约：根据文法的产生式规则，把串中出现的产生式右部替换成左部符号； 从树的叶节点开始"><meta name=application-name content="shesl's blog"><meta name=apple-mobile-web-app-title content="shesl's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://shesl-meow.github.io/book/%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E8%AF%BE%E7%A8%8B/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/2.%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90/%E8%87%AA%E4%B8%8B%E8%80%8C%E4%B8%8A/><link rel=next href=http://shesl-meow.github.io/book/%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E8%AF%BE%E7%A8%8B/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/2.%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90/%E8%87%AA%E4%B8%8A%E8%80%8C%E4%B8%8B/><link rel=stylesheet href=/css/style.min.fa85115dce490a9d0bf009e2892b6d42439bdea75160d08cddcb0b97c8def676.css integrity="sha256-+oURXc5JCp0L8AniiSttQkOb3qdRYNCM3csLl8je9nY="><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/shesl-meow.github.io\/book\/%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E8%AF%BE%E7%A8%8B\/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86\/2.%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90\/%E8%87%AA%E4%B8%8B%E8%80%8C%E4%B8%8A\/"},"genre":"book","wordcount":3944,"url":"http:\/\/shesl-meow.github.io\/book\/%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E8%AF%BE%E7%A8%8B\/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86\/2.%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90\/%E8%87%AA%E4%B8%8B%E8%80%8C%E4%B8%8A\/","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"佘崧林"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="shesl's blog">shesl-meow</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>博客 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="shesl's blog">shesl-meow</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>博客</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster"></h1><div class=content id=content><h1 id=自下而上-bottom-up>自下而上 Bottom-up</h1><p>从输入串开始，逐步进行归约，直到文法的开始符号。</p><ul><li>规约：根据文法的产生式规则，把串中出现的产生式右部替换成左部符号；</li></ul><p>从树的叶节点开始，构造语法树。</p><p>算法：算符优先分析法，LR 分析法。</p><h2 id=简述概念>简述概念</h2><p>基本思想：</p><ul><li>采用 “移进-规约” 思想进行自下而上分析</li><li>用一个寄存符号的先进后出栈，把输入符号一个一个地移进栈里，当栈顶形成某个产生式的候选式时，即把栈顶的这一部分替换为（规约）该产生式的左部</li></ul><p>核心问题：<strong>识别可归约串</strong>。</p><p>短语：</p><ul><li>令 G 是一个文法，S 是文法的开始符号，假设 $$\alpha \beta \delta$$ 是文法 G 的一个句型，如果有 $$S \overset{*}{\Rightarrow} \alpha A \delta 且 A \overset{+}{\Rightarrow} \beta$$，则 $$\beta$$ 称是句型 $$\alpha \beta \delta$$ 相对于非终结符 A 的<strong>短语</strong>。</li><li>如果有 $$A \Rightarrow \beta$$，则称 $$\beta$$ 是句型 $$\alpha \beta \delta$$ 相对于规则 $$A \rightarrow \beta$$ 的<strong>直接短语</strong>。</li><li>一个句型的最左直接短语称为该句型的<strong>句柄</strong>。</li></ul><p>分析过程描述：可以用 <code>步骤</code>、<code>符号栈</code>、<code>输入串</code>、<code>所用产生式</code> 四元组来描述。</p><h2 id=算符优先法>算符优先法</h2><h3 id=定义>定义</h3><p>优先关系：</p><ul><li>任何两个可能相继出现的终结符的终结符 a 与 b 可能三种优先关系：<ol><li>$$a \lessdot b$$，a 的优先级低于 b</li><li>$$a \doteq b$$，a 的运算级等于 b</li><li>$$a \gtrdot b$$，a 的运算级高于 b</li></ol></li><li>算符优先关系与数学上的 <code>&lt;</code> <code>></code> <code>=</code> 不同：<ul><li>$$+ \lessdot + $$ → 右边的加号比左边的加号优先级高，即算术右结合</li><li>$$a \lessdot b$$ 并不意味着 $$b \gtrdot a$$</li></ul></li></ul><p>算符文法：</p><ul><li>如果一个文法的任一产生式的右部都不含两个相继的非终结符，即不含 <code>...QR...</code> 形式的产生式右部，则我们称该文法为<strong>算符文法</strong>。</li><li>假设 G 是一个不含 $$\epsilon$$-产生式的算符文法。对于任何一对终结符 a、b，我们说：<ol><li>$$a \doteq b$$，当且仅当文法 G 中含有形如 $$P \rightarrow &mldr;ab&mldr;$$ 或 $$P \rightarrow &mldr;aQb&mldr;$$ 的产生式</li><li>$$a \lessdot b$$，当且仅当 G 中含有形如 $$P \rightarrow &mldr;aR&mldr;$$ 的产生式，且有 $$R \overset{+}{\Rightarrow} b&mldr;$$ 或 $$R \overset{+}{\Rightarrow} Qb&mldr;$$</li><li>$$a \gtrdot b$$，当且仅当 G 中含有形如 $$P \rightarrow &mldr;Rb&mldr;$$ 的产生式，且有 $$R \overset{+}{\Rightarrow} &mldr;a$$ 或 $$R \overset{+}{\Rightarrow} &mldr;aQ$$</li></ol></li><li>如果一个算符文法 G 中的任何终结符对 $$(a, b)$$，至多只满足 $$a \doteq b$$、$$a \lessdot b$$ 和 $$a \gtrdot b$$ 这三个关系之一，则称 G 是一个<strong>算符优先文法</strong>。</li></ul><h3 id=构造优先关系表>构造优先关系表</h3><p>算法：</p><ol><li>确定所有满足 $$\doteq$$ 的所有终结符对：<ul><li>通过检查 G 的每个产生式的候选式；</li></ul></li><li>确定满足关系 $$\lessdot$$ 和 $$\gtrdot$$ 的所有终结符对：<ul><li>先构造下面两个集合：<ul><li>$$FIRSTVT(P) = {a | P \overset{+}{\Rightarrow} a&mldr; \or P \overset{+}{\Rightarrow} Qa&mldr;, a \in V_T \and Q \in V_N}$$</li><li>$$LASTVT(P) = {a | P \overset{+}{\Rightarrow} &mldr;a \or P \overset{+}{\Rightarrow} &mldr;aQ, a \in V_T \and Q \in V_N}$$</li></ul></li><li>检查每个产生式的候选式：<ul><li>假定一个产生式有一个候选式为 $$&mldr;aP&mldr;$$，那么，对于任何 $$b \in FIRSTVT(P)$$，我们都有 $$a \lessdot b​$$；</li><li>假定一个产生式有一个候选式形为 $$&mldr;Pb&mldr;$$，那么，对于任何 $$a \in LASTVT(P)$$，有 $$a \gtrdot b$$。</li></ul></li></ul></li></ol><p>构造集合 $$FIRSTVT(P)$$ 的算法：</p><ul><li>反复使用下面的两条规则构造集合 $$FIRSTVT(P)$$：<ol><li>若有产生式 $$P \rightarrow a&mldr;$$ 或 $$P \rightarrow Qa&mldr;$$，则 $$FIRSTVT(P) += {a}$$</li><li>若 $$\exist P \rightarrow Q&mldr;$$，则 $$FIRSTVT(P) += FIRSTVT(Q)$$</li></ol></li><li>不断扫描，直到在一整次扫描中没有一个 $$FIRSTVT$$ 集合发生变化。</li></ul><p>一个实现的伪代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GLOBAL:
</span></span><span class=line><span class=cl>	STACK stack;
</span></span><span class=line><span class=cl>	BOOLEN array[ size(V_N) ][ size(V_T) ];
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>INIT:
</span></span><span class=line><span class=cl>	for prod in PROD; do
</span></span><span class=line><span class=cl>		a = prod.right.first_V_T()
</span></span><span class=line><span class=cl>		p = prod.left
</span></span><span class=line><span class=cl>		array[p][a] = true
</span></span><span class=line><span class=cl>		stack.push([p, a])
</span></span><span class=line><span class=cl>	done
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>MAIN:
</span></span><span class=line><span class=cl>	while not stack.empty(); do
</span></span><span class=line><span class=cl>		top = stack.pop()
</span></span><span class=line><span class=cl>		Q, a = top[0], top[1]
</span></span><span class=line><span class=cl>		for prod in PROD; do
</span></span><span class=line><span class=cl>			Qc = prod.right.first_symbol()
</span></span><span class=line><span class=cl>			P = prod.left
</span></span><span class=line><span class=cl>			
</span></span><span class=line><span class=cl>			if (Qc is Q) and (array[P][a] is false); then
</span></span><span class=line><span class=cl>				array[P][a] = true
</span></span><span class=line><span class=cl>				stack.push([P, a])
</span></span><span class=line><span class=cl>	        endif
</span></span><span class=line><span class=cl>		done
</span></span><span class=line><span class=cl>	done
</span></span></code></pre></td></tr></table></div></div><p>其中 <code>array[P][]</code> 中所有为 <code>true</code> 的列就是 $$FIRSTVT(P)$$ 集合。</p><p>同理可以构造 $$LASTVT(P)$$ 集合：</p><ul><li>反复使用下面的两条规则构造集合 $$LASTVT(P)$$：<ol><li>若有产生式 $$P \rightarrow &mldr;b$$ 或 $$P \rightarrow &mldr;Qb$$，则 $$LASTVT(P) += {b}$$</li><li>若 $$\exist P \rightarrow &mldr;Q$$，则 $$LASTVT(P) += LASTVT(Q)$$</li></ol></li><li>不断扫描，直到在一整次扫描中没有一个 $$LASTVT$$ 集合发生变化。</li></ul><p>同样的也可以写出伪代码实现。</p><h3 id=算符优先分析算法>算符优先分析算法</h3><p>概念：</p><ul><li><strong>素短语</strong>：至少含有一个终结符且不再含任何比它自身更小的素短语。</li><li><strong>最左素短语</strong>：处于句型最左边的那个素短语。</li></ul><p>最左素短语定理：</p><ul><li><p>算符优先文法句型的一般形式为：</p><p>$$\begin{align}sentence: &#N_1a_1N_2a_2&mldr;N_na_nN_{n+1}#,\ where: &\forall i, a_i \in V_T, N_i \in V_N \cap{\epsilon}\end{align}$$</p></li><li><p>则定理：一个满足以下条件的最左边的子串 $$N_ia_i&mldr;N_ja_j$$ 是最左素短语：</p><ol><li>$$a_{i-1} \lessdot a_i$$</li><li>$$\forall s,t \in [i, j], a_s \doteq a_t$$</li><li>$$a_j \gtrdot a_{j+1}$$</li></ol></li></ul><p>算符优先分析算法的伪代码描述：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=n>GLOBAL</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>STACK</span><span class=w> </span><span class=n>analysis</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>STACK</span><span class=w> </span><span class=n>input</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>INIT</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>top</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>analysis</span><span class=p>.</span><span class=nf>push</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MAIN</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>repeat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>input</span><span class=p>.</span><span class=nf>pop</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>j</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>analysis</span><span class=p>[</span><span class=n>top</span><span class=p>]</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>V_T</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>top</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>top</span><span class=o>-</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1># WHILE:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=c1># repeat until the precedence of top symbol is greater than the next symbol
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=nf>precedence_greater</span><span class=p>(</span><span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>],</span><span class=w> </span><span class=n>a</span><span class=p>);</span><span class=w> </span><span class=n>do</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1># REPEAT:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=c1># find the terminal symbol position in stack where its precedence is less than the continous topper one
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=k>repeat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Q</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>analysis</span><span class=p>[</span><span class=n>j</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>j</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>analysis</span><span class=p>[</span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>V_T</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>j</span><span class=o>-</span><span class=mi>1</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>j</span><span class=o>-</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>until</span><span class=w> </span><span class=nf>precedence_less</span><span class=p>(</span><span class=n>analysis</span><span class=p>[</span><span class=n>j</span><span class=p>],</span><span class=w> </span><span class=n>Q</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1># `REDUCT` function is used to reduct list of symbol into a non-terminal symbol.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=n>N</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>REDUCT</span><span class=p>(</span><span class=n>analysis</span><span class=p>[</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=n>S</span><span class=p>[</span><span class=n>top</span><span class=p>]);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>top</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>analysis</span><span class=p>[</span><span class=n>top</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>N</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>done</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1># IF:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=c1># if the next symbol is legal, push it into the stack
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nf>precedence_less</span><span class=p>(</span><span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>],</span><span class=w> </span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=nf>precedence_equal</span><span class=p>(</span><span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>],</span><span class=w> </span><span class=n>a</span><span class=p>);</span><span class=w> </span><span class=k>then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        	</span><span class=n>top</span><span class=o>++</span><span class=p>,</span><span class=w> </span><span class=n>S</span><span class=p>[</span><span class=n>top</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=n>ERROR</span><span class=p>;</span><span class=w> </span><span class=n>fi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>until</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=s1>&#39;#&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=lr-分析法>LR 分析法</h2><h3 id=定义-1>定义</h3><p>规范规约：</p><ul><li>假定 $$\alpha$$ 是文法 G 的一个句子且满足以下的条件，则我们称序列 $$\alpha_n, \alpha_{n-1}, &mldr;, \alpha_0$$ 是 $$\alpha$$ 的一个规范规约：<ol><li>$$\alpha_n = \alpha$$</li><li>$$\alpha_0 = S$$</li><li>$$\forall i, 0 \lt i \le n$$，$$\alpha_{i-1}$$ 是从 $$\alpha_i$$ 经把句柄替换成相应产生式的左部符号得到的。</li></ol></li><li>NOTICE：规范规约得到的树是语法树，但是算符优先分析方法得到的树不是语法树（算符优先分析方法不是规范规约）。</li></ul><p>规范推导：</p><ul><li>因为规范规约是最左规约，规范规约的逆过程就是最右推导。最右推导也称<strong>规范推导</strong>，由规范推导推出的句型又叫规范句型。</li></ul><p>LR 文法：</p><ul><li>对于一个文法，如果能够构造一张分析表，使得它的每个入口均是唯一确定的，则这个文法就称为 <strong>LR 文法</strong>。</li><li>一个文法，如果能够用一个每步最多向前检查 k 个输入符号的 LR 分析器进行分析，则这个文法就称作 <strong>LR(k) 文法</strong>。</li><li>LR 文法 $$\subset$$ 无二义文法。</li></ul><p>LR 分析表：LR 分析器的核心是一张分析表：</p><ul><li><code>ACTION[s, a]</code>：当前状态 s 面临输入符号 a 时，应该采取什么动作。比如：<ul><li><code>s5</code>：表示 shift，表示把当前文法符号移进入栈，并且将状态 5 压栈。</li><li><code>r4</code>：表示 reduce，表示用第 4 个产生式规约，把产生式右部和状态弹出栈，把 <code>GOTO[栈顶状态, 产生式左部]</code> 和 <code>产生式左部</code> 非终结符移入栈。</li></ul></li><li><code>GOTO[s, X]</code>：状态 s 面对文法符号 X 时，下一个状态是什么。</li><li><code>acc</code>：宣布分析成功，停止分析器工作。</li><li><code>空白</code>：不允许出现的情况，出现了需要报错。</li></ul><h3 id=活前缀>活前缀</h3><p>字的前缀、活前缀：</p><ul><li>字的<strong>前缀</strong>：字的任意首部。</li><li><strong>活前缀</strong>：指规范句型的一个前缀，这种前缀不含句柄之后的任意符号。<ul><li>即：如果 $$\beta$$ 是 $$\alpha \beta \delta$$ 的句柄，如果 $$\alpha \beta = u_1 u_2 &mldr; u_r$$，则符号串 $$u_1 u_2 &mldr; u_i (1 \le i \le r)$$ 是 $$\alpha \beta \delta$$ 的一个活前缀。</li></ul></li></ul><p>拓广文法：</p><ul><li>构造文法 G&rsquo;，它包含了整个 G，并且引进不出现在 G 中的新的开始符号非终结符 S&rsquo;、以及产生式 $$S&rsquo; \rightarrow S$$。</li></ul><p>$$LR(0)$$ 项目：</p><ul><li>在每个产生式右部添加一个圆点，表示我们在分析过程中看到了产生式的多大部分。</li><li>$$A \rightarrow \alpha \cdot$$ 称为 “规约项目”</li><li>$$S&rsquo; \rightarrow \alpha \cdot$$ 称为 “接受项目”（“接受项目” $$\subset$$ “规约项目”）</li><li>$$A \rightarrow \alpha \cdot a \beta$$ 称为 “移进项目”</li><li>$$A \rightarrow \alpha \cdot B \beta$$ 称为 “待约项目”</li></ul><p>构造识别活前缀的 DFA：</p><ul><li><p>构造识别文法所有活前缀的 NFA：</p><ol><li><p>${\displaystyle State(i): X \rightarrow X_1 X_2 &mldr; X_{i-1} \cdot X_i&mldr;X_n}$</p><p>${\displaystyle State(j):X \rightarrow X_1 X_2&mldr;X_i \cdot X_{i+1} &mldr; X_n}$</p><p>${\displaystyle \Rightarrow f(State(i), X_i) = State(j) }$</p></li><li><p>${\displaystyle State(i): X \rightarrow \alpha \cdot A \beta}$</p><p>$ State(j): A \rightarrow \cdot \gamma $</p><p>$\Rightarrow f(State(i), \epsilon) = State(j) $</p></li></ol></li><li><p>把该识别文法所有活前缀的 NFA 确定化为 DFA。</p></li><li><p><em>PS</em>：构成识别一个文法活前缀的 DFA 的项目集（状态）的全体称为文法的 <strong>LR(0) 项目集规范族</strong>。</p></li></ul><p>构造的另一种方法（通过有效项目集）：</p><ul><li><p>有效项目：项目 $$A \rightarrow \beta_1 \cdot \beta_2$$ 对活前缀 $$\alpha \beta_1$$ 是有效的，如果存在规范推导：$$S&rsquo; \overset{*}{\Rightarrow}_R \alpha A \omega \Rightarrow_R \alpha \beta_1 \beta_2 \omega $$</p></li><li><p>定理：若项目 $$A \rightarrow \alpha \cdot B \beta$$ 对于活前缀 $$\eta = \delta \alpha$$ 是有效的且 $$B \rightarrow \gamma$$ 是一个产生式，则项目 $$B \rightarrow \cdot \gamma$$ 对 $$\eta = \delta \alpha$$ 也是有效的。</p></li><li><p>构造项目集 I 的闭包 $$CLOSURE(I)$$：</p><ol><li>I 的任何项目都属于 $$CLOSURE(I)$$；</li><li>若 $$A \rightarrow \alpha \cdot B \beta$$ 属于，任意关于 B 的产生式 $$B \rightarrow \gamma$$，项目 $$B \rightarrow \cdot \gamma$$ 也属于 $$CLOSURE(I)$$；</li><li>重复执行上述两步直至 $$CLOSURE(I)$$ 不再增大为止。</li></ol></li><li><p>状态转换函数 GO：对于 I 是一个项目集，X 是一个文法符号，则：</p><p>$$\begin{align} GO(I, X) &= CLOSURE(J) \where\ J &= {A \rightarrow \alpha X \cdot \beta \mid (A \rightarrow \alpha \cdot X \beta) \in I} \end{align}$$</p></li><li><p>构造方法：</p><ol><li><p>$$State := {CLOSURE({S&rsquo; \rightarrow \cdot S})}$$</p></li><li><p>对于 State 中的每个项目集 I 和 G&rsquo; 中的每个文法符号 X：</p><p>$$State += GO(I, X), where\ GO(I, X) \neq \varnothing \and GO(I, X) \notin State $$</p></li><li><p>重复第二步直到 State 不再增大。</p></li></ol></li></ul><h3 id=lr0-分析表>LR(0) 分析表</h3><p>假若一个文法 G 的拓展文法 G&rsquo; 的活前缀识别自动机中的每个状态（项目集）不存在以下的情况，则称 G 是一个 LR(0) 文法。</p><ul><li>既含移进项目又含规约项目；</li><li>含有多个规约项目。</li></ul><p>构造 LR(0) 分析表的算法：</p><ol><li>令每个项目集 $$I_k$$ 的下标 k 作为分析器的状态，包含项目 $$S&rsquo; \rightarrow \cdot S$$ 的集合 $$I_k$$ 的下标 k 为分析器的初始状态。</li><li>构造分析表的 ACTION 子表：<ol><li>若项目 $$A \rightarrow \alpha \cdot a \beta$$ 属于 $$I_k$$ 且 $$GO(I_k, a) = I_j$$，a 为终结符，则置 $$ACTION[k, a] = &ldquo;sj&rdquo;$$（动作<code>移进</code>，进入状态<code>j</code>）</li><li>若项目 $$A \rightarrow \alpha \cdot$$ 属于 $$I_k$$，那么，$$\forall a \in V_N, a \in FOLLOW(A)$$，置 $$ACTION[k, a] = &ldquo;rj&rdquo;$$（动作<code>规约</code>，使用第 <code>j</code> 个产生式 $$A \rightarrow \alpha$$）</li><li>若项目 $$S&rsquo; \rightarrow S \cdot$$ 属于 $$I_k$$，则置 $$ACTION[k, $] = &ldquo;acc&rdquo;$$（动作接受）</li></ol></li><li>构造分析表的 GOTO 子表：<ul><li>若 $$GO(I_k, A) = I_j$$，其中 A 为非终结符，则置 $$GOTO[k, A] = j$$（在第 <code>k</code> 个状态，栈顶是 A 符时，下一个状态是 <code>j</code>）</li></ul></li><li>分析表中凡不能用规则上述规则填入信息的空白格均填入 “报错标志”。</li></ol><h2 id=slr1-分析法>SLR(1) 分析法</h2><p>LR(0) 中，一个项目集可能会包含多个规约项目，因为规约使用的规则必须向前看一个单词才可以选择规则进行规约，因此引入了 SLR(1) 分析法。其中 S 指 Simple，1 指最多向前看一个单词。</p><p>LR(0) 冲突解决办法：</p><ul><li>假定一个 $$LR(0)$$ 规范族中含有如下的项目集 $$I = {X \rightarrow a \cdot b \beta, A \rightarrow \alpha \cdot, B \rightarrow \alpha \cdot}$$，其中：$$I \in S, FOLLOW(A) \cap FOLLOW(B) = \varnothing, b \notin FOLLOW(A) \cup FOLLOW(B)$$</li><li>当状态 I 面临输入符号 a 时，可以：<ol><li>若 $$a = b$$，则移进</li><li>若 $$a \in FOLLOW(A)$$，用产生式 $$A \rightarrow \alpha$$ 进行规约；</li><li>若 $$a \in FOLLOW(B)$$，用产生式 $$B \rightarrow \alpha$$ 进行规约；</li><li>此外，报错。</li></ol></li></ul><p>更一般的：</p><ul><li>假定一个 $$LR(0)$$ 规范族中含有如下的项目集 $$I = {A_1 \rightarrow \alpha \cdot a_1 \beta_1, A_2 \rightarrow \alpha \cdot a_2 \beta_2, &mldr;, A_m \rightarrow \alpha \cdot a_m \beta_m, B_1 \rightarrow \alpha \cdot, B_2 \rightarrow \alpha \cdot, &mldr;, B_n \rightarrow \alpha \cdot }$$，其中：$$I \in S; \forall k \le m, i,j \le n, FOLLOW(B_i) \cap FOLLOW(B_j) = \varnothing, b_k \notin FOLLOW(B_i) \cup FOLLOW(B_j)$$</li><li>当状态 I 面临输入符号 a 时，可以：<ol><li>若 $$a \in {a_i \mid 0 &lt; i \le m }$$，则移进</li><li>若 $$a \in FOLLOW(B_i), 0 &lt; i \le n$$，用产生式 $$B_i \rightarrow \alpha$$ 进行规约；</li><li>此外，报错。</li></ol></li></ul><h2 id=lasr1-分析法>LASR(1) 分析法</h2><p>可以构造一个比规范 LR 分析表更小的分析表。其中 LA 指 lookhead。</p><p>同心项目集：（没看懂）</p><p>对于一个拓广文法 G&rsquo;，构造 LASR(1) 的分析表方法如下：</p><ol><li>构造 LR(1) 项目集规范族 $$C = {I_0, I_1, &mldr;, I_n}$$</li><li>将同心集合并</li><li>令 $$C&rsquo; = {J_0, &mldr;, J_m}$$ 为合并后项目集，构造 action 子表，如果有冲突则合并失败；</li><li>。。。</li></ol><h2 id=lr-分析产生器-yacc>LR 分析产生器 <code>YACC</code></h2><p>YACC (Yet Another Compiler Compiler)</p><p>LR 的变种：SALR(1)</p></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://shesl-meow.github.io target=_blank>佘崧林</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.4.18/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{valine:{appId:"zDVJohJIQbD6f3W267xtaYRC-gzGzoHsz",appKey:"ewsfU9ocNOeuvt0MzONe6yKx",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-CN",pageSize:10,placeholder:"你的评论 ...",recordIP:!0,serverURLs:"https://zdvjohji.lc-cn-n1-shared.com",visitor:!0}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"",algoliaIndex:"",algoliaSearchKey:"",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.c1d5acc03abc8af9ee0a42aa4e942566a338a3e29d21b6c9f11536101f6914ad.js integrity="sha256-wdWswDq8ivnuCkKqTpQlZqM4o+KdIbbJ8RU2EB9pFK0="></script></body></html>