<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Part 2: Containers - shesl's blog</title><meta name=Description content="佘崧林同学的碎碎念博客"><meta property="og:title" content="Part 2: Containers"><meta property="og:description" content="We start at the bottom of the hierarchy of such an app, which is a container, which we cover on this page. 新的开发环境 Container In the past, if you were to start writing a Python app, your first order of business was to install a Python runtime onto your machine. But, that creates a situation where the environment on your machine needs to be perfect"><meta property="og:type" content="article"><meta property="og:url" content="http://shesl-meow.github.io/note/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3/docker/2.containers/"><meta property="og:image" content="http://shesl-meow.github.io/avatar.png"><meta property="article:section" content="note"><meta property="article:published_time" content="2019-02-25T15:16:23+08:00"><meta property="article:modified_time" content="2019-02-25T15:16:23+08:00"><meta property="og:site_name" content="shesl's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://shesl-meow.github.io/avatar.png"><meta name=twitter:title content="Part 2: Containers"><meta name=twitter:description content="We start at the bottom of the hierarchy of such an app, which is a container, which we cover on this page. 新的开发环境 Container In the past, if you were to start writing a Python app, your first order of business was to install a Python runtime onto your machine. But, that creates a situation where the environment on your machine needs to be perfect"><meta name=application-name content="shesl's blog"><meta name=apple-mobile-web-app-title content="shesl's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://shesl-meow.github.io/note/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3/docker/2.containers/><link rel=next href=http://shesl-meow.github.io/note/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3/docker/1.orientation/><link rel=stylesheet href=/css/style.min.1310433f6cdab9b292f4d93b71eeb4dcd4a0fc3770f6d90e2d21faa5387856c5.css integrity="sha256-ExBDP2zaubKS9Nk7ce603NSg/Ddw9tkOLSH6pTh4VsU="><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Part 2: Containers","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/shesl-meow.github.io\/note\/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3\/docker\/2.containers\/"},"genre":"note","keywords":"","wordcount":1687,"url":"http:\/\/shesl-meow.github.io\/note\/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3\/docker\/2.containers\/","datePublished":"2019-02-25T15:16:23+08:00","dateModified":"2019-02-25T15:16:23+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"佘崧林"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="shesl's blog">shesl-meow</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>博客
</a><a class=menu-item href=/tags/>标签
</a><a class=menu-item href=/categories/>分类
</a><a class=menu-item href=/note/>笔记</a><div class=dropdown><a class="menu-item menu-more dropbtn" title href=javascript:void(0);>游戏</a><div class="menu-more-content dropdown-content"><a href=/games/2048/ title><i class='fa-solid fa-chess-board'></i> 2048</a></div></div><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="shesl's blog">shesl-meow</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/>博客
</a><a class=menu-item href=/tags/>标签
</a><a class=menu-item href=/categories/>分类
</a><a class=menu-item href=/note/>笔记</a><div class=dropdown><a class="menu-item menu-more dropbtn" title href=javascript:void(0);>游戏</a><div class="menu-more-content dropdown-content"><a href=/games/2048/ title><i class='fa-solid fa-chess-board'></i> 2048</a></div></div><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">Part 2: Containers</h1><div class=content id=content><p>We start at the bottom of the hierarchy of such an app, which is a container, which we cover on this page.</p><h2 id=新的开发环境-container>新的开发环境 <code>Container</code></h2><p>In the past, if you were to start writing a Python app, your first order of business was to install a Python runtime onto your machine. But, that creates a situation where the environment on your machine needs to be perfect for your app to run as expected, and also needs to match your production environment.</p><p>With Docker, you can just grab a portable Python runtime as an image, no installation necessary. Then, your build can include the base Python image right alongside your app code, ensuring that your app, its dependencies, and the runtime, all travel together.</p><p>These portable images are defined by something called a <code>Dockerfile</code>.</p><h2 id=用-dockerfile-定义-container>用 <code>Dockerfile</code> 定义 <code>Container</code></h2><p>文件 <code>Dockerfile</code> 定义了文件进入 <code>container</code> 的规则。令 <code>container</code> 像向网络接口请求数据一样向 <code>host</code> 机器请求数据，它与 <code>host</code> 其他环境完全分离，所以你需要定义一个端口映射到 <code>host</code> 的外界并且定义可以进入环境的文件。这些内容都可以写在 <code>Dockerfile</code> 这个文件中。</p><h3 id=dockerfile><code>Dockerfile</code></h3><p>一个基本的 <code>Dockerfile</code> 示例如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Use an official Python runtime as a parent image</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> python:2.7-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Set the working directory to /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy the current directory contents into the container at /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Install any needed packages specified in requirements.txt</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install --trusted-host pypi.python.org -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Make port 80 available to the world outside this container</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 80</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Define environment variable</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> NAME World<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Run app.py when the container launches</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;python&#34;</span><span class=p>,</span> <span class=s2>&#34;app.py&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>该 <code>Dockerfile</code> 中指明了 <code>app.py</code> 和 <code>requirement.txt</code> 两个文件未创建。</p><p>这两个文件只需要创建在与 <code>Dockerfile</code> 同级目录下，上面的 <code>COPY</code> 命令会将它们复制到镜像中，而其中的 <code>EXPOSE</code> 则使我们的 <code>app.py</code> 可以通过 <code>HTTP</code> 协议访问到。</p><p>接下来我们创建它们。</p><h3 id=apppy><code>app.py</code></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redis</span> <span class=kn>import</span> <span class=n>Redis</span><span class=p>,</span> <span class=n>RedisError</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Connect to Redis</span>
</span></span><span class=line><span class=cl><span class=n>redis</span> <span class=o>=</span> <span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;redis&#34;</span><span class=p>,</span> <span class=n>db</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>socket_connect_timeout</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>socket_timeout</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>visits</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=s2>&#34;counter&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>RedisError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>visits</span> <span class=o>=</span> <span class=s2>&#34;&lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>html</span> <span class=o>=</span> <span class=s2>&#34;&lt;h3&gt;Hello </span><span class=si>{name}</span><span class=s2>!&lt;/h3&gt;&#34;</span> \
</span></span><span class=line><span class=cl>           <span class=s2>&#34;&lt;b&gt;Hostname:&lt;/b&gt; </span><span class=si>{hostname}</span><span class=s2>&lt;br/&gt;&#34;</span> \
</span></span><span class=line><span class=cl>           <span class=s2>&#34;&lt;b&gt;Visits:&lt;/b&gt; </span><span class=si>{visits}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>html</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;NAME&#34;</span><span class=p>,</span> <span class=s2>&#34;world&#34;</span><span class=p>),</span> <span class=n>hostname</span><span class=o>=</span><span class=n>socket</span><span class=o>.</span><span class=n>gethostname</span><span class=p>(),</span> <span class=n>visits</span><span class=o>=</span><span class=n>visits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>80</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=requirementtxt><code>requirement.txt</code></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Flask
</span></span><span class=line><span class=cl>Redis
</span></span></code></pre></td></tr></table></div></div><p>运行以下命令测试环境是否正确：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ pip install -r requirement.txt
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ python app.py
</span></span><span class=line><span class=cl> * Serving Flask app <span class=s2>&#34;app&#34;</span> <span class=o>(</span>lazy loading<span class=o>)</span>
</span></span><span class=line><span class=cl> * Environment: production
</span></span><span class=line><span class=cl>   WARNING: Do not use the development server in a production environment.
</span></span><span class=line><span class=cl>   Use a production WSGI server instead.
</span></span><span class=line><span class=cl> * Debug mode: off
</span></span><span class=line><span class=cl> * Running on http://0.0.0.0:80/ <span class=o>(</span>Press CTRL+C to quit<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>浏览器中访问 <code>localhost</code>，便可以看到 <code>soket.gethostname()</code> 的结果。</p><h2 id=搭建-app>搭建 <code>app</code></h2><p>在项目根目录下运行以下命令 <code>build</code> 这个项目（其中 <code>-t</code> 选项是为了给镜像起名字，注意最后的 <code>.</code> 指明是当前文件夹）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker build -t test_image .
</span></span></code></pre></td></tr></table></div></div><p>可以通过以下的命令查看注册在 <code>Docker</code> 后台的镜像：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker image ls
</span></span></code></pre></td></tr></table></div></div><h3 id=troubleshooting-for-linux-users>Troubleshooting for Linux users</h3><ol><li><p>代理服务器可能会禁止你的 <code>web</code> 应用连接。如果你使用了代理服务器，添加以下内容到 <code>Dockerfile</code> 中，其中 <code>ENV</code> 后指明代理服务器的主机名和端口号：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Set proxy server, replace host:port with values for your servers</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> http_proxy host:port<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> https_proxy host:port<span class=err>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><code>DNS</code> 配置错误会导致 <code>pip</code> 安装命令失败。你可能需要更改 <code>Docker</code> 守护进程的 <code>DNS</code> 设置。使用 <code>dns key</code> 编辑（或创建）文件 <code>/etc/docker/daemon.json</code> ：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;dns&#34;</span>: <span class=o>[</span><span class=s2>&#34;your_dns_address&#34;</span>, <span class=s2>&#34;8.8.8.8&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>保存之后重启 <code>docker</code> 服务即可：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo service docker restart
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=启动-app>启动 <code>app</code></h2><p>通过以下命令启动服务（其中，<code>4000:80</code> 意为将机器的 <code>4000</code> 端口映射到容器内部的 <code>80</code> 端口）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker run -p 4000:80 test_image
</span></span></code></pre></td></tr></table></div></div><p>在浏览器中访问 <code>localhost:4000</code> 可以看到 <code>docker</code> 的运行结果。<code>curl</code> 命令也是同样的效果。</p><p><code>CTRL+C</code> 停止运行程序，在 windows 系统上或者 Linux 后台运行时可以使用以下命令先获取 <code>CONTAINER ID</code> 后停止运行程序：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker container ls
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                  NAMES
</span></span><span class=line><span class=cl>6ff52e6cfdbc        test_image          <span class=s2>&#34;python app.py&#34;</span>     <span class=m>10</span> seconds ago      Up <span class=m>8</span> seconds        0.0.0.0:4000-&gt;80/tcp   confident_hopper
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker container stop 6ff52e6cfdbc
</span></span></code></pre></td></tr></table></div></div><p>通过 <code>detached mode</code>，可以令 <code>app</code> 在后台运行，比如使用以下的命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker run -d -p 4000:80 test_image
</span></span></code></pre></td></tr></table></div></div><h2 id=镜像的可移植性>镜像的可移植性</h2><p>首先，当你想要将容器部署到生产环境时，你需要知道如何将容器推送到注册表 (registry)。</p><p>A registry is a collection of repositories, and a repository is a collection of images—sort of like a GitHub repository, except the code is already built. An account on a registry can create many repositories. The <code>docker</code> CLI uses Docker’s public registry by default.</p><h3 id=log-in-with-your-docker-id>Log in with your Docker ID</h3><p>在 <code>Docker</code> 官网 <a href=https://hub.docker.com target=_blank rel="noopener noreffer">https://hub.docker.com</a> 上注册账户，并用以下的命令在本地机器上登陆账户：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker login
</span></span></code></pre></td></tr></table></div></div><h3 id=tag-the-image>Tag the image</h3><p>将本地的一个镜像与注册表上的仓库关联起来的方式是 <code>username/repository:tag</code>。<code>tag</code> 是可选的，但是推荐使用，因为它是注册表给每个镜像一个版本名称的机制。</p><p>Now, put it all together to tag the image. Run <code>docker tag image</code> with your username, repository, and tag names so that the image uploads to your desired destination. The syntax of the command is:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker tag &lt;image&gt; &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt;
</span></span></code></pre></td></tr></table></div></div><p>Run <code>docker image ls</code> to see your newly tagged image.</p><h3 id=publish-the-image>Publish the image</h3><p>以下的命令可以用于上传仓库：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker push &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt;
</span></span></code></pre></td></tr></table></div></div><p>Once complete, the results of this upload are publicly available. If you log in to <a href=https://hub.docker.com/ target=_blank rel="noopener noreffer">Docker Hub</a>, you see the new image there, with its pull command.</p><h3 id=pull-and-run-the-image-from-the-remote-repository>Pull and run the image from the remote repository</h3><p>现在，你可以通过以下的命令在任何一个机器上运行你的 <code>app</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker run -p 4000:80  &lt;username&gt;/&lt;repository&gt;:&lt;tag&gt;
</span></span></code></pre></td></tr></table></div></div><p>如果 <code>image</code> 在本机并不可用，<code>Docker</code> 会自动从远端拉取镜像。</p><h2 id=命令总结>命令总结</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t friendlyhello .  <span class=c1># Create image using this directory&#39;s Dockerfile</span>
</span></span><span class=line><span class=cl>docker run -p 4000:80 friendlyhello  <span class=c1># Run &#34;friendlyhello&#34; mapping port 4000 to 80</span>
</span></span><span class=line><span class=cl>docker run -d -p 4000:80 friendlyhello         <span class=c1># Same thing, but in detached mode</span>
</span></span><span class=line><span class=cl>docker container ls                                <span class=c1># List all running containers</span>
</span></span><span class=line><span class=cl>docker container ls -a             <span class=c1># List all containers, even those not running</span>
</span></span><span class=line><span class=cl>docker container stop &lt;hash&gt;           <span class=c1># Gracefully stop the specified container</span>
</span></span><span class=line><span class=cl>docker container <span class=nb>kill</span> &lt;hash&gt;         <span class=c1># Force shutdown of the specified container</span>
</span></span><span class=line><span class=cl>docker container rm &lt;hash&gt;        <span class=c1># Remove specified container from this machine</span>
</span></span><span class=line><span class=cl>docker container rm <span class=k>$(</span>docker container ls -a -q<span class=k>)</span>         <span class=c1># Remove all containers</span>
</span></span><span class=line><span class=cl>docker image ls -a                             <span class=c1># List all images on this machine</span>
</span></span><span class=line><span class=cl>docker image rm &lt;image id&gt;            <span class=c1># Remove specified image from this machine</span>
</span></span><span class=line><span class=cl>docker image rm <span class=k>$(</span>docker image ls -a -q<span class=k>)</span>   <span class=c1># Remove all images from this machine</span>
</span></span><span class=line><span class=cl>docker login             <span class=c1># Log in this CLI session using your Docker credentials</span>
</span></span><span class=line><span class=cl>docker tag &lt;image&gt; username/repository:tag  <span class=c1># Tag &lt;image&gt; for upload to registry</span>
</span></span><span class=line><span class=cl>docker push username/repository:tag            <span class=c1># Upload tagged image to registry</span>
</span></span><span class=line><span class=cl>docker run username/repository:tag                   <span class=c1># Run image from a registry</span>
</span></span></code></pre></td></tr></table></div></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://shesl-meow.github.io target=_blank>佘崧林</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.4.18/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{valine:{appId:"zDVJohJIQbD6f3W267xtaYRC-gzGzoHsz",appKey:"ewsfU9ocNOeuvt0MzONe6yKx",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-CN",pageSize:10,placeholder:"你的评论 ...",recordIP:!0,serverURLs:"https://zdvjohji.lc-cn-n1-shared.com",visitor:!0}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"",algoliaIndex:"",algoliaSearchKey:"",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.9e0af26d07ef470e0d850462fcb087fccb1971e3f2978405eceab01351a2028b.js integrity="sha256-ngrybQfvRw4NhQRi/LCH/MsZcePyl4QF7OqwE1GiAos="></script></body></html>